# 任务四

定义相机内参为：
$$
K= 
\left[
\matrix{
  f_x & 0 & c_x\\
  0 & f_y & c_y\\
  0 & 0 & 1 
}
\right]
$$


1.
$$
P_C = R^TP_W-R^Tt = 
\left[\matrix{
  X_C\\
  Y_C\\
  Z_C 
}
\right]
$$

$$
p =\frac{1}{Z_C}*K P_C
$$





2.
$$
P_C = R^TP_W-R^Tt = 
\left[\matrix{
  X_C\\
  Y_C\\
  Z_C 
}
\right]
$$
归一化的相机坐标系：
$$
P_{C1} =
\left[\matrix{
  X_C/Z_C\\
  Y_C/Z_C\\
  1
}
\right]
=
\left[\matrix{
  X_{C1}\\
  Y_{C1}\\
  1
}
\right]
$$
在归一化平面上求解畸变后的坐标：
$$
\begin{cases}X_{dis}=X_{C1}(2 +k_1r^2+k_2r^4+k_3r^6)+2p_1X_{C1}Y_{C1}+p_2(r^2+2X_{C1}^2)
\\ Y_{dis}=Y_{C1}(2 +k_1r^2+k_2r^4+k_3r^6)+ p_1(r^2 + 2Y_{C1}^2)+2p_2X_{C1}Y_{C1}  \end{cases}
$$

> 其中r<sup>2</sup> = X~C1~ <sup>2</sup> + y~C1~ <sup>2</sup>

$$
p =K 
\left[\matrix{
  X_{dis}\\
  Y_{dis}\\
  1
}
\right]
$$





3.参考vins的去畸变流程
$$
归一化相机平面坐标： P_{C1} =K p
$$
对P~c1~进行畸变处理，得到P^'^ ~C1~ ，求解两点的增量△p，对P~new~ = P~c1~ - △p，得到新的坐标点。

重复以上操作直到增量△p小于阈值或者达到迭代次数，得到的坐标点就是去畸变后的坐标点



4.

重投影误差模型：
$$
e_{ij} = z_{ij} - H(x_i)
$$
其中
$$
H(x_i) = \frac{K}{Z_C} (R_w^{c_i}f_j^w + t_w^{c_i})
$$


整体的重投影误差为：
$$
\frac{1}{2}\sum_{i=1}^{m}\sum_{j=1}^{n}{||e_{ij}||^2} = \frac{1}{2}\sum_{i=1}^{m}\sum_{j=1}^{n}{||z_{ij} - H(x_i)||^2}
$$


单个误差的雅各比矩阵为：
$$
J_{ij}(x_i) = (0,0,..,\frac{偏导e_{ij}}{偏导T_i},0,0...,\frac{偏导e_{ij}}{偏导f_j},0,...,0)
$$








