# 任务五



## 5.3

alpha参数的意义在于是否裁剪畸变图像。

alpha = 1，所有像素均保留，存在去畸变后的黑色像素填充，包含图像的所有像素，四个角点是去畸变后的图像四个边界点。

alpha = 0，对图像进行裁剪，不存在填充的黑色像素，四周为去畸变后的图像最大像素边界。



## 5.4

SIFT特征点数目越多，存在的匹配关系越多，结果会越精确，但到了一定的数目阈值后，一味的增加特征点数目并不能提高结果精度，因为增加的匹配点的质量不够好；调节RANSAC阈值，阈值越小，存在的匹配点越多，过滤掉的匹配点越少，反之阈值大了以后，存在的匹配点会减少，过滤掉的匹配点会很多，但存在的匹配点质量会比较好。



## 5.5.1

对于齐次线性方程组，是否有**解析解**直接取决于A 的秩。分为以下几种情况：1.r(A)=n，且A为n*n 的方阵或线性无关方程个数与未知数个数相同，此时有且只有零解；2.r(A)<n，此时要么矩阵A 的行小于列，要么行向量线性相关，这种情况下约束不够，有无穷解。



设矩阵 A 为m行n列的矩阵，我们知道对于任意A，做SVD 分解有：
$$
A=UDV^T=U\left[
\matrix{
  \sum \\
 0
}
\right]V^T
$$
 U 和 V 都是正定矩阵， D 为奇异值按从大到小构建的对角阵，超过列数的行统一置位0。因此对于 Ax=0 ,有：
$$
Ax=UDV^T \cdot x=0
$$


由于 U 为正定矩阵，对于齐次线性方程组 Ax=0 ，如果A 为满秩方阵，那么 x 有唯一零解的结论。因此结合上式，可得：
$$
DV^T \cdot x=0
$$


进一步简化，设 V^T^ ⋅ x = y ，有 Dy=0

 因此，我们既然要求解最小二乘解，结合最小二乘思想，此处变为求解 ||Dy||~2~=0 的非零解y 的过程。我们将其展开有：
$$
||Dy||_2=y^TD^TDy=y^T\left[
\matrix{
  \sum 
  ~ 0
  }
\right]
\left[
\matrix{
  \sum \\
 ~0
}
\right]y
$$

$$
=\left[
\matrix{
  y_1 ~
  y_2 ~
  \cdots
  y_n
  }
\right]

\left[
\matrix{
  \sigma^2_1 & \quad  & \quad & \quad\\
  \quad  & \sigma^2_2  & \quad& \quad \\
  \quad  &  \quad  & \cdots & \quad\\
  \quad &\quad & \quad  & \sigma^2_n
}
\right]
\left[
\matrix{
  y_1 \\
  y_2 \\
  \cdots \\
  y_n
  }
\right]
$$

$$
=\sigma^2_1y^2_1+\sigma^2_2y^2_2+\cdots+\sigma^2_ny^2_n
$$



已知SVD分解后，奇异值满足如下关系：
$$
\sigma_1 \geq \sigma_2 \geq \cdots \geq \sigma_n \geq 0
$$
因此，**要 ||Dy||2 达到最小，且向量 y 为非零向量，那么一定有**
$$
y = \left[
\matrix{
 0 ~
  0 ~
  \cdots
  y_n
  }
\right]^T
$$
那么结合V^T^⋅x=y，有x=V⋅y 因此， x 的表达式变为：
$$
x=Vy=\left[
\matrix{
  v_1 ~
  v_2 ~
  \cdots
  v_n
  }
\right]
\left[
\matrix{
  y_1 \\
  y_2 \\
  \cdots \\
  y_n
  }
\right]
=\left[
\matrix{
  v_1 ~
  v_2 ~
  \cdots
  v_n
  }
\right]
\left[
\matrix{
  0 \\
  0 \\
  \cdots \\
  y_n
  }
\right]
=v_n \cdot
y_n
$$


其中 y~n~ 为一常量，我们知道对于齐次线性方程组而言，如果向量 a 是解，那么任意线性组合如 k⋅a ，仍是它的解。**因此x=v~n~，即SVD 分解后，V 的最后一列向量，此时最小二乘的误差最小。**



## 5.5.2

已知两张图像上的匹配点p~1~ ，p~2~

1.基础矩阵求解：
$$
p_1\simeq KP ~,~p_2\simeq K(RP+t)
$$
归一化相机平面：
$$
x_1=K^{-1}p1, ~ x_2=K^{-1}p2
$$
代入上式：
$$
x_2\simeq Rx_1+t \\
t^\Lambda x_2 \simeq t^\Lambda Rx_1 \\
x_2^T t^\Lambda Rx_1 =0 \\
$$
将p~1~和p~2~代入得：
$$
p_2^T K^{-T} t^\Lambda RK^{-1}p_1 =0 \\
F = K^{-T} t^\Lambda RK^{-1}
$$


2.对F矩阵进行分解R、t

先对其通过内参K求解出E，再对E进行分解

根据一般反对称矩阵的块分解方法，任意一个3×3的反对称矩阵S都可以被写成S=kUZU^T^的形式，其中U是正交矩阵，Z=diag⁡(1,1,0)W，其中W是正交矩阵：
$$
Z=\left[
\matrix{
  0 &1 & 0\\
  -1 & 0 & 0\\
  0 & 0 & 0
}
\right],~
W=\left[
\matrix{
  0 & -1 & 0\\
  1 & 0 & 0\\
  0 & 0 & 1 
}
\right]
$$
于是有：
$$
S = kU\left[
\matrix{
  1 & 0 & 0\\
  0 & 1 & 0\\
  0 & 0 & 0
}
\right]WU^T
$$
以及：
$$
E=t^\Lambda R =SR = U\left[
\matrix{
  k & 0 & 0\\
  0 & k & 0\\
  0 & 0 & 0
}
\right]WU^TR
$$
其中(WU^T^R)仍然是正交矩阵，对本质矩阵E进行SVD分解如下：
$$
E=U\sum V^T=U\left[
\matrix{
  k & 0 & 0\\
  0 & k & 0\\
  0 & 0 & 0
}
\right](WU^TR) \\
WU^TR = V^T \\
R_1=UW^TV^T
$$
又因为：
$$
t^\Lambda_1 = S =U\left[
\matrix{
  0 & k & 0\\
  -k & 0 & 0\\
  0 & 0 & 0
}
\right]U^T
=
\left[
U
\left[
\matrix{
  0\\
  0\\
 k
}
\right]
\right]^\Lambda \\
t_1 = U\left[
\matrix{
  0\\
  0\\
 k
}
\right] = 
\left[
\matrix{
  U_0\
  U_1\
 U_2\
}
\right]
\left[
\matrix{
  0\\
  0\\
 k
}
\right] = U_2k
$$
又因为本质矩阵E的尺度等价特性，t乘上任意一个非零常数都能满足对极约束，因此可以去掉系数k，得到：**t~1~ = U~2~**

即t等于矩阵U的最后一列。

又因为Z和W选取如下的值时以上推导也仍然成立：
$$
Z=\left[
\matrix{
  0 &-1 & 0\\
  1 & 0 & 0\\
  0 & 0 & 0
}
\right],~
W=\left[
\matrix{
  0 & 1 & 0\\
  -1 & 0 & 0\\
  0 & 0 & 1 
}
\right]
$$
因此R和t还有第二种解：
$$
R_2=UWV^T \\
t_2 = U
\left[
\matrix{
  0\\
  0\\
 -k
}
\right]=-U_2k=-t_1
$$
综上：
$$
R_1=UW^TV^T ,~t_1=U_2\\
R_2=UWV^T,~ t_2=-U_2
$$
同时由于E具有尺度等价性， −E仍然满足本质矩阵的方程约束和充要条件，因此同样可以分解出两组解。实际上我们无需重新计算，因为 −E 分解出来的R,t 与E分解出来的R,t只是在位移t上相差一个负号。故−E分解出来的两种解是(R1,t2)，(R2,t1) 。因此，从E分解到t,R时，一共存在四个可能的解。



## 5.5.3

当近似的旋转矩阵R并不是一个严格的标准正交矩阵时，将R通过SVD分解:
$$
R=U \sum V^T
$$
直接使用单位阵代替奇异值矩阵，保证了R的正交性。
$$
R=UV^T
$$
但是旋转矩阵还有一个行列式值为1的性质，需要调节奇异值矩阵来求解：
$$
\sum =
\left[
\matrix{
  1 &\quad & \quad\\
  \quad & 1 & \quad\\
  \quad & \quad & det(UV^T)
}
\right]
$$
